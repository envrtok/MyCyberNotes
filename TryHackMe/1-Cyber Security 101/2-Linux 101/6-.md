# SSH Protocol
- SSH(Secure Shell) is a protocol allows connect and control machines securely.
- It provides:
	- Confidentiality(data is encrypted)
	- Integrity
	- Authentication

## Usage
```bash
ssh <username>@<ip address>
```
```bash
#when asked
password: <password>
```

## How it Works?
### Step 0: Starting
You typed down ssh username@ip-address and our travel has been started.
Your client parses the username, host and port informations, and opens a TCP socket to SSH port.
### Step 1: Version Control
Client sends version and server replies with its own version. So both are confirms they are using protocol version 2.

### Step 2: Algorithm Selection
Client sends list of algorithm which it supports. And server chooses one and respondes its choice.
They are selecting algorithm for:
   - Key excange
   - Host key types
   - Encryption
   - MAC (Message Authentication Code)
   - Compression (optional)
### Step 3: Key Exchange
They are creating a secret session key that no one else can now, they're doing this with **Diffie-Hellman Algorithm**
This secret key provides no foreign can join the conversation, because secret key always being used until session being closed.
#### Algorithm Detalis:
1. **Client** picks a random number `a`, computes `A = g^a mod p`, and sends `A` to server.
    
2. **Server** picks a random number `b`, computes `B = g^b mod p`, and sends `B` back.
    
3. Both compute the shared secret:
    
    - Client computes `K = B^a mod p`
        
    - Server computes `K = A^b mod p`
        
    - Mathematically, they both get the same value `K`.
        

Now both sides know `K`, but anyone listening canâ€™t compute it easily ðŸ”¥

### Step 4: Authentication
Server provides that if it is you, with password or public SSH key. Authentication step is occurring in client side.  Client provides a password or key for logging in.

### Step 5: Session
After authentication succeeded, client and server provides you logged in and creates a session

### Step 6: Data Transfer & Command Execution
Every key and byte is being encrypted with secret key while sending, and decrypting while reading and executing.
Each packet has a MAC (message authentication code) to prevent tampering. It provides the message wasn't changed during transfer.
